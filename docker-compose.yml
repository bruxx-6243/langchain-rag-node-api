version: "3.4"

services:
  langchain-rag-api:
    image: langchain-rag-api

    build:
      context: .
      dockerfile: ./Dockerfile

    ports:
      - "4000:4000"

    env_file:
      - .env

    volumes:
      - type: bind
        source: ./uploads
        target: /app/uploads
        bind:
          create_host_path: true

  # Cleanup service that runs periodically
  uploads-cleanup:
    image: langchain-rag-api
    volumes:
      - ./uploads:/app/uploads
      - ./cleanup-uploads.js:/app/cleanup-uploads.js
    command: node cleanup-uploads.js
    restart: "no"
    profiles:
      - cleanup
